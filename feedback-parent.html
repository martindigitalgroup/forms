<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feedback</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="Expansion-Favicon.png" />
  <style>
    /* General styling */
    body {
      font-family: Calibri, sans-serif;
      text-align: center;
      margin: 20px;
      position: relative;
      color: #3f3f3f;
      background-color: #D2DBDB; /* Page background */
    }

    /* Extra padding above the title */
    h1 {
      padding-top: 30px;
    }

    /* Container for the SVG feedback options */
    #responses {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 15px;
      position: relative;
    }

    /* Ensure the SVG is centered horizontally */
    #responses svg {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }

    /* Mobile-specific styles */
    @media only screen and (max-width: 600px) {
      #responses {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;  /* Prevent the container from collapsing vertically */
      }
      #responses svg {
        width: 90%;         /* Use a percentage of the container width */
        max-width: 600px;    /* Still allow it to scale up to 600px if space allows */
        height: auto;
        flex-shrink: 0;      /* Prevent shrinking */
      }
    }

    /* SVG and feedback option styles */
    .feedback-option {
      transform-origin: center;
      transition: transform 0.2s ease;
    }

    .feedback-option path {
      cursor: pointer;
    }

    .feedback-option:hover {
      transform: scale(1.02) translate(0%, -1%);
    }

    .feedback-option.selected path:not(.cls-2) {
      fill: #d4f4dd; /* Match hover green */
    }

    .feedback-option.grayscale#crying path:not(.cls-2) {
      filter: grayscale(100%) brightness(59%);
    }

    .feedback-option.grayscale#sad path:not(.cls-2) {
      filter: grayscale(100%) brightness(68%);
    }

    .feedback-option.grayscale#neutral path:not(.cls-2) {
      filter: grayscale(100%) brightness(81%);
    }

    .feedback-option.grayscale#happy path:not(.cls-2) {
      filter: grayscale(100%) brightness(88%);
    }

    .feedback-option.grayscale#excited path:not(.cls-2) {
      filter: grayscale(100%) brightness(96%);
    }

    /* Submit button styling */
    #submitButton {
      position: absolute;
      top: calc(50% + 120px);
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      background-color: #2DAAB3;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: Calibri, sans-serif;
      font-size: 15pt;
      font-weight: bold;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }

    #submitButton:hover {
      background-color: #5CCED6;
      transform: translate(-50%, -50%) scale(1.05);
    }

    #submitButton:disabled {
      background-color: #A4B5B6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- Dynamic heading will be updated via JavaScript -->
  <h1 id="mainHeading">How are you feeling about the EMR coming to your site?</h1>

  <div id="responses">
    <!-- The SVG now includes preserveAspectRatio to center its internal content -->
    <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="-20 -20 840 437" preserveAspectRatio="xMidYMid meet">
      <defs>
        <style>
          .cls-1 { fill: #d1edef; }
          .cls-2 { fill: #3f3f3f; }
          .cls-3 { fill: #65bfc6; }
          .cls-4 { fill: #b8e2e6; }
          .cls-5 { fill: #88ced3; }
          .cls-6 { fill: #effafb; }
        </style>
      </defs>
      <g id="Layer_1-2" data-name="Layer 1">
        <g id="excited" class="feedback-option" onclick="selectResponse('Excited')">
          <path class="cls-6" d="M575.1,276.65c24.04,34.11,38.33,75.57,38.84,120.35h186.01c-.63-85.6-28.14-164.8-74.52-229.58l-150.34,109.23Z"/>
          <g>
            <path class="cls-2" d="M697.7,257l5.37.68c22.38,3.7,40.45,22.26,43.39,44.81.16,1.23.12,2.58.44,3.77-.09,2.17.13,4.4,0,6.57-2.69,45.95-60.31,66.37-91.45,31.91-29.42-32.55-7.74-85.18,35.68-87.73h6.56ZM691.71,263.63c-35.78,2.11-55.69,43.16-34.69,72.56,19.43,27.19,60.37,25.27,77.13-3.61,18.38-31.65-6.13-71.09-42.44-68.95Z"/>
            <path class="cls-2" d="M668.12,318.81c.47-.08.87-.09,1.34,0,1.47.26,3.7,3.34,4.96,4.47,11.32,10.17,28.67,10.12,39.99,0,1.44-1.29,3.36-4.18,5.17-4.47,2.7-.43,4.62,2.42,3.37,4.82-.77,1.49-4.46,4.87-5.89,6.01-13.09,10.42-32.21,10.43-45.3,0-1.29-1.02-5.8-5.19-6.16-6.55-.49-1.86.56-3.95,2.52-4.27Z"/>
            <path class="cls-2" d="M675.1,289.48c7.08-.85,12.94,4.11,11.68,11.49-.43,2.53-3.33,3.61-5.38,2s-.46-4.05-1.49-5.69c-1.25-1.98-6.22-1.68-6.6.67-.26,1.67.47,3.14-.86,4.68-1.81,2.09-5.33,1.05-5.69-1.63-.79-5.8,2.37-10.8,8.34-11.52Z"/>
            <path class="cls-2" d="M710.36,289.48c7.33-.88,12.95,4.14,11.68,11.69-.41,2.45-3.65,3.41-5.47,1.67-2.1-2,.09-4.93-2.13-6.28-1.45-.89-4.36-.87-5.45.59-1.3,1.74.94,5.56-2.94,6.5-4.56,1.1-4.57-5.22-3.6-8.11,1.06-3.15,4.65-5.66,7.9-6.05Z"/>
          </g>
        </g>
        <g id="sad" class="feedback-option" onclick="selectResponse('Sad')">
          <path class="cls-5" d="M229.2,272.03c25.48-34.18,60.94-60.47,102.07-74.55l-57.55-177.13c-78.97,26.25-147.01,76.45-195.5,141.99l150.98,109.69Z"/>
          <g>
            <path class="cls-2" d="M215.82,97.75c38.5-1.72,65.91,38.29,50.16,73.72-16.72,37.61-68.44,42.37-91.47,8.11-22.95-34.15.57-80.01,41.31-81.83ZM215.18,104.38c-34.42,2.08-54.6,40.75-36.1,70.21s59.99,28.74,77.93-.13c19.66-31.65-4.89-72.31-41.82-70.08Z"/>
            <path class="cls-2" d="M216.89,153.52c10.24-.34,21.24,4.74,26.38,13.84,1.07,1.89,1.58,4.44-.86,5.52-3.67,1.62-4.7-2.41-6.49-4.57-9.17-10.99-26.67-10.99-35.83,0-1.86,2.23-2.4,5.5-6.04,4.75-1.48-.3-2.45-2.22-2.24-3.64s2.25-4.06,3.16-5.18c5.36-6.61,13.41-10.45,21.93-10.73Z"/>
            <path class="cls-2" d="M200.45,130.65c9.06-1.33,10.33,11.88,2.27,12.96-9.03,1.21-10.23-11.79-2.27-12.96Z"/>
            <path class="cls-2" d="M233.09,130.65c10.17-1.6,10.35,14.32.18,12.96-7.08-.95-7.13-11.87-.18-12.96Z"/>
          </g>
        </g>
        <g id="happy" class="feedback-option" onclick="selectResponse('Happy')">
          <path class="cls-1" d="M469.24,197.32c41.23,14.02,76.79,40.28,102.35,74.47l150.33-109.22c-48.41-65.53-116.35-115.75-195.23-142.08l-57.45,176.82Z"/>
          <g>
            <path class="cls-2" d="M579.82,97.75c38.5-1.72,65.91,38.29,50.16,73.72-16.72,37.61-68.44,42.37-91.47,8.11-22.95-34.15.57-80.01,41.31-81.83ZM579.18,104.38c-34.42,2.08-54.6,40.75-36.1,70.21,18.06,28.77,59.99,28.74,77.93-.13,19.66-31.65-4.89-72.31-41.82-70.08Z"/>
            <path class="cls-2" d="M554.84,156.92c3.15-.65,3.59,1.67,5.09,3.56,10.03,12.59,34,12.74,44.04.12.64-.8,1.14-1.95,1.81-2.67,2.68-2.86,7.29.08,4.98,4.34-8.32,15.35-33.44,17.63-47.47,9.59-3.03-1.74-9.77-7.33-10.64-10.71-.44-1.71.34-3.85,2.19-4.23Z"/>
            <path class="cls-2" d="M564.45,130.65c9.06-1.33,10.33,11.88,2.27,12.96-9.03,1.21-10.23-11.79-2.27-12.96Z"/>
            <path class="cls-2" d="M597.09,130.65c10.17-1.6,10.35,14.32.18,12.96-7.08-.95-7.13-11.87-.18-12.96Z"/>
          </g>
        </g>
        <g id="neutral" class="feedback-option" onclick="selectResponse('Neutral')">
          <path class="cls-4" d="M336.97,195.61c20.06-6.24,41.39-9.61,63.51-9.61s43.12,3.32,63.05,9.47l57.46-176.83C482.81,6.54,442.16,0,399.98,0s-82.51,6.48-120.56,18.5l57.55,177.11Z"/>
          <g>
            <path class="cls-2" d="M397.82,42.01c38.5-1.72,65.91,38.29,50.16,73.72-16.72,37.61-68.44,42.37-91.47,8.11-22.95-34.15.57-80.01,41.31-81.83ZM397.18,48.63c-34.42,2.08-54.6,40.75-36.1,70.21,18.06,28.77,59.99,28.74,77.93-.13,19.66-31.65-4.89-72.31-41.82-70.08Z"/>
            <path class="cls-2" d="M380.32,107.6l38.98-.06c4.21.08,5,5.63.86,6.62h-40.34c-3.97-.92-3.51-6.19.49-6.57Z"/>
            <path class="cls-2" d="M382.45,74.9c9.06-1.33,10.33,11.88,2.27,12.96-9.03,1.21-10.23-11.79-2.27-12.96Z"/>
            <path class="cls-2" d="M415.09,74.9c10.17-1.6,10.35,14.32.18,12.96-7.08-.95-7.13-11.87-.18-12.96Z"/>
          </g>
        </g>
        <g id="crying" class="feedback-option" onclick="selectResponse('Crying')">
          <path class="cls-3" d="M225.69,276.9l-151-109.71C28.21,232.01.63,311.3,0,397h187.01c.51-44.67,14.74-86.04,38.67-120.1Z"/>
          <g>
            <path class="cls-2" d="M112.78,257l5.37.67c22.38,3.69,40.45,22.24,43.39,44.77.16,1.23.12,2.58.44,3.76v6.56c-.32,1.18-.28,2.53-.44,3.76-3.78,28.57-30.5,48.81-59.08,45.01-23.09-3.07-41.98-21.88-45-45.01-.16-1.23-.12-2.58-.44-3.76.09-2.17-.13-4.4,0-6.56,1.52-25.99,23.22-47.69,49.2-49.21h6.56ZM106.79,263.62c-35.77,2.11-55.68,43.13-34.68,72.5,19.42,27.17,60.36,25.25,77.12-3.61,18.37-31.63-6.13-71.04-42.44-68.89Z"/>
            <path class="cls-2" d="M106.59,313.45c9.72-.82,18.93,2.95,24.72,10.83,1.25,1.7,3.89,5.76,3.56,7.82-.16,1.04-1.32,2.35-2.36,2.57-3.53.73-4.06-2.66-5.43-4.94-7.85-13.1-27.31-13.05-35.18,0-1.38,2.28-1.9,5.67-5.43,4.94-1.04-.22-2.19-1.52-2.36-2.57-.28-1.77,1.76-5.24,2.78-6.76,4.28-6.41,11.92-11.23,19.69-11.89Z"/>
            <path class="cls-2" d="M138.56,299.9c2.14-.35,2.84.81,4.03,2.23,3.99,4.79,9.01,11.34,4.12,17.41-6.34,7.88-19.21,2-16.61-8.41.64-2.56,4.68-8.06,6.56-10.05.56-.59,1.05-1.04,1.9-1.18ZM139.43,308.67c-.32-.08-.33.05-.5.22-.77.76-2.46,3.33-2.58,4.39-.48,4.27,5.64,4.27,5.76.62.07-2.09-1.85-3.51-2.69-5.23Z"/>
            <path class="cls-2" d="M91.01,286.99c9.73-.2,10.35,14.32,1.38,15.32-11.31,1.27-11.76-15.11-1.38-15.32Z"/>
            <path class="cls-2" d="M127.7,286.99c9.76-.2,10.37,14.32,1.38,15.32-11.29,1.26-11.71-15.11-1.38-15.32Z"/>
          </g>
        </g>
      </g>
    </svg>
  </div>

  <!-- Submit button -->
  <button id="submitButton" onclick="submitResponse()" disabled>Submit</button>

  <script>
    // Update the heading based on the URL query parameter "site"
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const siteName = params.get("site") || "your site";
      document.getElementById("mainHeading").textContent = `How are you feeling about the EMR coming to ${siteName}?`;
    });

    let selectedResponse = null;

    function selectResponse(response) {
      const selectedGroup = document.getElementById(response.toLowerCase());
      
      // Toggle deselection if clicking the same option.
      if (selectedResponse === response) {
        selectedResponse = null;
        document.querySelectorAll('.feedback-option').forEach(option => {
          option.classList.remove('selected', 'grayscale');
        });
        document.getElementById('submitButton').disabled = true;
        return;
      }
      
      // Clear previous selection.
      document.querySelectorAll('.feedback-option').forEach(option => {
        option.classList.remove('selected', 'grayscale');
      });
      
      selectedResponse = response;
      selectedGroup.classList.add('selected');
      
      // Apply grayscale to non-selected options.
      document.querySelectorAll('.feedback-option').forEach(option => {
        if (!option.classList.contains('selected')) {
          option.classList.add('grayscale');
        }
      });
      
      // Enable the Submit button.
      const submitButton = document.getElementById('submitButton');
      submitButton.disabled = false;
      submitButton.style.display = 'inline-block';
    }

    function submitResponse() {
      if (!selectedResponse) {
        alert("Please select a response before submitting.");
        return;
      }
  
      const webhookUrl = "https://hooks.zapier.com/hooks/catch/15554156/2at36b2/";
      const formData = new URLSearchParams();
  
      // Append the selected response.
      formData.append('response', selectedResponse);
  
      // Parse URL query parameters and append each individually.
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.forEach((value, key) => {
        formData.append(key, value);
      });
  
      // Send the POST request.
      fetch(webhookUrl, {
        method: "POST",
        body: formData
      })
      .then(response => {
        if (response.ok) {
          console.log("Webhook sent successfully!");
          // Build the redirect URL and append the same query parameters.
          const redirectUrl = new URL("https://phasefour.zapier.app/thank-you");
          urlParams.forEach((value, key) => {
            redirectUrl.searchParams.append(key, value);
          });
          redirectUrl.searchParams.append('response', selectedResponse);
          window.location.href = redirectUrl.toString();
        } else {
          alert("There was an issue submitting your feedback. Please try again.");
          console.error("Failed to send webhook");
        }
      })
      .catch(err => {
        alert("An error occurred while submitting your feedback.");
        console.error("Error sending webhook:", err);
      });
    }
  </script>
</body>
</html>
