<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Feedback</title>
  <style>
    /* Styling for the response options */
    .option {
      display: inline-block;
      margin: 10px;
      padding: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
    }
    .option:hover {
      background-color: #d0d0d0;
    }
    /* Styling for the Submit button (initially hidden) */
    #submitButton {
      display: none;
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #2563EB;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <!-- Container for the response options -->
  <div id="responses">
    <div class="option" onclick="selectOption('Excited')">Excited</div>
    <div class="option" onclick="selectOption('Neutral')">Neutral</div>
    <div class="option" onclick="selectOption('Disappointed')">Disappointed</div>
  </div>
  
  <!-- Submit button that appears after selecting an option -->
  <a id="submitButton" href="https://phasefour.zapier.app/thank-you">Submit</a>
  
  <script>
    /**
     * Called when an option is clicked.
     * @param {string} response - The selected response.
     */
    function selectOption(response) {
      console.log("Selected response:", response);
      
      // Send the webhook with the response and any URL parameters.
      sendWebhook(response);
      
      // Hide the options container.
      document.getElementById("responses").style.display = "none";
      
      // Show the Submit button.
      document.getElementById("submitButton").style.display = "inline-block";
    }
    
    /**
     * Sends a POST request (webhook) to Zapier with the selected response and URL parameters.
     * @param {string} response - The user's selected response.
     */
    function sendWebhook(response) {
      const webhookUrl = "https://hooks.zapier.com/hooks/catch/15554156/2at36b2/";
      
      // Create URL-encoded form data.
      const formData = new URLSearchParams();
      formData.append('response', response);
      
      // Parse URL query parameters (e.g. ?site=ABC&location=your_mums_house&craft_group=midwifery)
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.forEach((value, key) => {
        formData.append(key, value);
      });
      
      // Send the POST request.
      fetch(webhookUrl, {
        method: "POST",
        // Passing the URLSearchParams object directly lets the browser set
        // the Content-Type header to "application/x-www-form-urlencoded;charset=UTF-8"
        body: formData
      })
      .then((res) => {
        if (res.ok) {
          console.log("Webhook sent successfully!");
        } else {
          console.error("Failed to send webhook");
        }
      })
      .catch((err) => {
        console.error("Error sending webhook:", err);
      });
    }
  </script>
</body>
</html>
